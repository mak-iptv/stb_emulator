<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STB Player - Generim nga MAC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #16213e;
            border-radius: 10px;
        }
        
        .header h1 {
            color: #00ff88;
            margin-bottom: 10px;
        }
        
        .setup-box {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .server-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input, select, button {
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }
        
        input {
            background: white;
            color: #333;
        }
        
        button {
            background: #00ff88;
            color: #1a1a2e;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background: #00cc6a;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .channels {
            background: #16213e;
            padding: 15px;
            border-radius: 10px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .channel {
            padding: 15px;
            margin-bottom: 10px;
            background: #0f3460;
            border-radius: 5px;
            cursor: pointer;
            border-left: 4px solid #00ff88;
        }
        
        .channel:hover {
            background: #1a508b;
        }
        
        .channel.offline {
            opacity: 0.6;
            border-left-color: #ff4444;
        }
        
        .player-container {
            background: black;
            border-radius: 10px;
            padding: 10px;
            position: relative;
        }
        
        video {
            width: 100%;
            border-radius: 5px;
            background: #000;
        }
        
        .player-info {
            padding: 15px;
            background: rgba(0,0,0,0.8);
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            background: #16213e;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .success { color: #00ff88; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #00aaff; }
        
        .server-info {
            background: #16213e;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .info-item {
            padding: 10px;
            background: #0f3460;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”Œ STB MAG PLAYER - Generim Stream-i nga MAC</h1>
            <p>Shkruaj detajet e serverit tÃ«nd STB pÃ«r tÃ« gjeneruar stream-et direkt nga MAC adresa</p>
        </div>

        <div class="setup-box">
            <div class="server-form">
                <input type="text" id="serverUrl" placeholder="http://server-i-tend.com" value="http://">
                <input type="text" id="serverPort" placeholder="Porti (8080)" value="8080">
                <input type="text" id="macAddress" placeholder="MAC: 00:1A:79:XX:XX:XX" value="00:1A:79:">
                <select id="protocol">
                    <option value="m3u">M3U Format</option>
                    <option value="ts">TS Stream</option>
                    <option value="m3u8">M3U8 HLS</option>
                </select>
                <button onclick="generateFromMAC()">ğŸ”— GJENERO STREAM-ET</button>
            </div>
        </div>

        <div class="content">
            <div class="channels" id="channelsList">
                <div style="text-align: center; padding: 40px; opacity: 0.7;">
                    ğŸ“¡ Kliko "GJENERO STREAM-ET" pÃ«r tÃ« ngarkuar kanalet nga MAC adresa
                </div>
            </div>

            <div class="player-container">
                <video id="videoPlayer" controls muted>
                    Browser-i yt nuk mbÃ«shtet videon.
                </video>
                <div class="player-info">
                    <div id="nowPlaying">Zgjidhni njÃ« kanal pÃ«r tÃ« luajtur</div>
                    <div id="streamInfo" style="font-size: 12px; opacity: 0.8;"></div>
                </div>
            </div>
        </div>

        <div class="status">
            <span id="statusMessage" class="info">ğŸŸ¢ Gati pÃ«r gjenerim stream-esh nga MAC adresa</span>
        </div>

        <div class="server-info">
            <h3>ğŸ“Š Informacioni i Serverit</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Status:</strong> <span id="serverStatus">I palidhur</span>
                </div>
                <div class="info-item">
                    <strong>MAC:</strong> <span id="currentMAC">-</span>
                </div>
                <div class="info-item">
                    <strong>Server:</strong> <span id="currentServer">-</span>
                </div>
                <div class="info-item">
                    <strong>Kanale:</strong> <span id="channelCount">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        class STBStreamGenerator {
            constructor() {
                this.channels = [];
                this.currentChannel = null;
                this.serverConfig = null;
            }

            // Gjenero URL stream nga MAC adresa
            generateStreamURL(macAddress, channelId, protocol = 'm3u') {
                // Formatet e ndryshme tÃ« stream-ve bazuar nÃ« MAC
                const baseURL = this.serverConfig ? 
                    `${this.serverConfig.url}:${this.serverConfig.port}` : 
                    'http://server-i-tend.com:8080';

                // Nga MAC adresa krijojmÃ« parametra unikÃ«
                const macHash = this.hashMAC(macAddress);
                const timestamp = Date.now();
                
                switch(protocol) {
                    case 'm3u':
                        return `${baseURL}/get.php?username=${macHash}&password=${macHash}&type=m3u&output=ts`;
                    
                    case 'm3u8':
                        return `${baseURL}/live/${macHash}/${channelId}/index.m3u8?token=${timestamp}`;
                    
                    case 'ts':
                        return `${baseURL}/live/${macHash}/${channelId}.ts?token=${timestamp}`;
                    
                    default:
                        return `${baseURL}/get.php?username=${macHash}&password=${macHash}&type=m3u`;
                }
            }

            // Hash MAC adresÃ«n pÃ«r tÃ« krijuar credentiale unike
            hashMAC(mac) {
                let hash = 0;
                for (let i = 0; i < mac.length; i++) {
                    hash = ((hash << 5) - hash) + mac.charCodeAt(i);
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(16).substring(0, 8);
            }

            // Simuloj gjenerimin e kanaleve nga serveri STB
            async generateChannelsFromMAC(serverUrl, port, macAddress, protocol) {
                this.serverConfig = { url: serverUrl, port, macAddress, protocol };
                
                // PÃ«rditÃ«so informacionin e serverit
                document.getElementById('currentMAC').textContent = macAddress;
                document.getElementById('currentServer').textContent = `${serverUrl}:${port}`;
                document.getElementById('serverStatus').textContent = 'Duke gjeneruar...';
                document.getElementById('serverStatus').className = 'warning';

                // Simuloj vonesÃ« lidhjeje
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Gjenero kanale tÃ« ndryshme bazuar nÃ« MAC
                const channelTemplates = this.getChannelTemplatesByMAC(macAddress);
                
                this.channels = channelTemplates.map((template, index) => {
                    const streamUrl = this.generateStreamURL(macAddress, template.id, protocol);
                    
                    return {
                        id: template.id,
                        name: template.name,
                        url: streamUrl,
                        category: template.category,
                        quality: template.quality,
                        isOnline: Math.random() > 0.2, // 80% online
                        bitrate: this.getBitrate(template.quality),
                        resolution: this.getResolution(template.quality),
                        description: `Gjeneruar nga MAC: ${macAddress}`
                    };
                });

                return this.channels;
            }

            // Kthe template kanalesh bazuar nÃ« MAC
            getChannelTemplatesByMAC(mac) {
                // MAC prefix pÃ«rcakton llojin e kanaleve
                const macPrefix = mac.substring(0, 8);
                
                const templates = {
                    '00:1A:79': [ // MAG Devices
                        { id: 101, name: 'ğŸ“º RTSH 1 HD', category: 'ShqipÃ«ri', quality: 'HD' },
                        { id: 102, name: 'ğŸ“º RTSH 2', category: 'ShqipÃ«ri', quality: 'SD' },
                        { id: 103, name: 'ğŸ“º Top Channel HD', category: 'ShqipÃ«ri', quality: 'HD' },
                        { id: 104, name: 'ğŸ“º Klan TV', category: 'ShqipÃ«ri', quality: 'HD' },
                        { id: 105, name: 'ğŸ“º Vizion Plus', category: 'ShqipÃ«ri', quality: 'HD' },
                        { id: 201, name: 'ğŸŒ CNN International', category: 'NdotÃ«ror', quality: 'HD' },
                        { id: 202, name: 'ğŸŒ BBC World', category: 'NdotÃ«ror', quality: 'HD' },
                        { id: 301, name: 'âš½ SuperSport 1', category: 'Sport', quality: 'FHD' },
                        { id: 302, name: 'âš½ SuperSport 2', category: 'Sport', quality: 'FHD' }
                    ],
                    '00:1B:67': [ // STB Devices
                        { id: 111, name: 'ğŸ¬ Film Hits HD', category: 'Filma', quality: 'FHD' },
                        { id: 112, name: 'ğŸ¬ Action TV', category: 'Filma', quality: 'HD' },
                        { id: 113, name: 'ğŸ¬ Comedy Central', category: 'Filma', quality: 'HD' },
                        { id: 211, name: 'ğŸ“¡ Discovery HD', category: 'Dokumentar', quality: 'HD' },
                        { id: 212, name: 'ğŸ“¡ Nat Geo Wild', category: 'Dokumentar', quality: 'HD' }
                    ],
                    'default': [ // Default templates
                        { id: 999, name: 'ğŸ“º Test Channel 1', category: 'Test', quality: 'HD' },
                        { id: 998, name: 'ğŸ“º Test Channel 2', category: 'Test', quality: 'SD' },
                        { id: 997, name: 'ğŸµ Music Channel', category: 'Muzik', quality: 'HD' }
                    ]
                };

                return templates[macPrefix] || templates['default'];
            }

            getBitrate(quality) {
                const bitrates = { 'SD': '1.5 Mbps', 'HD': '3 Mbps', 'FHD': '6 Mbps', '4K': '15 Mbps' };
                return bitrates[quality] || '1.5 Mbps';
            }

            getResolution(quality) {
                const resolutions = { 'SD': '720x576', 'HD': '1280x720', 'FHD': '1920x1080', '4K': '3840x2160' };
                return resolutions[quality] || '720x576';
            }

            // Shfaq kanalet nÃ« listÃ«
            displayChannels() {
                const channelsList = document.getElementById('channelsList');
                channelsList.innerHTML = '<h3>ğŸ“¡ Kanalet e Gjeneruara</h3>';
                
                this.channels.forEach(channel => {
                    const channelElement = document.createElement('div');
                    channelElement.className = `channel ${channel.isOnline ? '' : 'offline'}`;
                    channelElement.innerHTML = `
                        <strong>${channel.name}</strong>
                        <div style="font-size: 12px; opacity: 0.8;">
                            ${channel.category} â€¢ ${channel.quality} â€¢ ${channel.bitrate}
                            ${!channel.isOnline ? ' â€¢ ğŸ”´ OFFLINE' : ''}
                        </div>
                        <div style="font-size: 10px; opacity: 0.6; margin-top: 5px;">
                            ${channel.description}
                        </div>
                    `;
                    
                    if (channel.isOnline) {
                        channelElement.onclick = () => this.playChannel(channel);
                    }
                    
                    channelsList.appendChild(channelElement);
                });

                document.getElementById('channelCount').textContent = this.channels.length;
            }

            // Luaj kanalin
            async playChannel(channel) {
                const videoPlayer = document.getElementById('videoPlayer');
                const nowPlaying = document.getElementById('nowPlaying');
                const streamInfo = document.getElementById('streamInfo');

                nowPlaying.textContent = `â–¶ï¸ Po luan: ${channel.name}`;
                streamInfo.textContent = `${channel.quality} â€¢ ${channel.resolution} â€¢ ${channel.bitrate}`;

                showMessage(`ğŸ”„ Duke ngarkuar ${channel.name}...`, 'info');

                try {
                    // Shto timestamp pÃ«r tÃ« shmangur cache
                    const cacheBusterUrl = channel.url + (channel.url.includes('?') ? '&' : '?') + 't=' + Date.now();
                    
                    videoPlayer.src = cacheBusterUrl;
                    videoPlayer.load();

                    await videoPlayer.play();
                    
                    showMessage(`âœ… Po luan: ${channel.name}`, 'success');
                    document.getElementById('serverStatus').textContent = 'Online';
                    document.getElementById('serverStatus').className = 'success';

                } catch (error) {
                    console.error('Gabim nÃ« play:', error);
                    
                    // Provim me fallback nÃ«se stream-i nuk punon
                    this.tryFallbackStream(channel);
                }
            }

            // Provim me stream fallback
            tryFallbackStream(channel) {
                showMessage(`ğŸ”„ Duke provuar fallback pÃ«r ${channel.name}...`, 'warning');
                
                const videoPlayer = document.getElementById('videoPlayer');
                const fallbackUrls = [
                    'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                    'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4'
                ];

                let currentFallback = 0;
                
                const tryNext = () => {
                    if (currentFallback < fallbackUrls.length) {
                        videoPlayer.src = fallbackUrls[currentFallback];
                        videoPlayer.load();
                        
                        videoPlayer.play().then(() => {
                            showMessage(`âœ… Po luan fallback stream`, 'success');
                        }).catch(() => {
                            currentFallback++;
                            tryNext();
                        });
                    } else {
                        showMessage(`âŒ Nuk mund tÃ« luajÃ« ${channel.name}`, 'error');
                    }
                };
                
                tryNext();
            }
        }

        // Initialize generator
        const streamGenerator = new STBStreamGenerator();

        // Funksioni kryesor pÃ«r gjenerim
        async function generateFromMAC() {
            const serverUrl = document.getElementById('serverUrl').value;
            const serverPort = document.getElementById('serverPort').value;
            const macAddress = document.getElementById('macAddress').value;
            const protocol = document.getElementById('protocol').value;

            if (!serverUrl || serverUrl === 'http://') {
                showMessage('âŒ Shkruaj URL e serverit!', 'error');
                return;
            }

            if (!macAddress || macAddress === '00:1A:79:') {
                showMessage('âŒ Shkruaj MAC adresÃ« tÃ« vlefshme!', 'error');
                return;
            }

            showMessage('ğŸ”„ Duke gjeneruar stream-et nga MAC adresa...', 'info');

            try {
                const channels = await streamGenerator.generateChannelsFromMAC(
                    serverUrl, serverPort, macAddress, protocol
                );
                
                streamGenerator.displayChannels();
                showMessage(`âœ… U gjeneruan ${channels.length} kanale nga MAC: ${macAddress}`, 'success');

            } catch (error) {
                showMessage(`âŒ Gabim nÃ« gjenerim: ${error.message}`, 'error');
            }
        }

        // Shfaq mesazhe statusi
        function showMessage(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = type;
        }

        // Kontroll me tastierÃ«
        document.addEventListener('keydown', function(e) {
            const videoPlayer = document.getElementById('videoPlayer');
            
            switch(e.key) {
                case ' ': e.preventDefault(); videoPlayer.paused ? videoPlayer.play() : videoPlayer.pause(); break;
                case 'f': case 'F': e.preventDefault(); toggleFullscreen(); break;
                case 'm': case 'M': e.preventDefault(); videoPlayer.muted = !videoPlayer.muted; break;
            }
        });

        function toggleFullscreen() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Auto-generate MAC nÃ«se Ã«shtÃ« bosh
        document.getElementById('macAddress').addEventListener('focus', function() {
            if (this.value === '00:1A:79:') {
                this.value = generateRandomMAC();
            }
        });

        function generateRandomMAC() {
            const prefixes = ['00:1A:79', '00:1B:67', '00:1C:43'];
            const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
            const suffix = Array.from({length: 3}, () => 
                Math.floor(Math.random() * 256).toString(16).padStart(2, '0')
            ).join(':');
            return `${prefix}:${suffix}`.toUpperCase();
        }
    </script>
</body>
</html>
