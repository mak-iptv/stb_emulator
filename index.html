<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XUI One Player - XtreamUI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
        }
        
        .header h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .connection-panel {
            background: #16213e;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #00ff88;
        }
        
        input, select, button {
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input {
            background: white;
            color: #333;
        }
        
        button {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #1a1a2e;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: #667eea;
            padding: 10px 15px;
            font-size: 14px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 25px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .sidebar {
            background: #16213e;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .filter-section {
            margin-bottom: 20px;
        }
        
        .search-box {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: none;
        }
        
        .category-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .category-btn {
            background: #0f3460;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .category-btn.active {
            background: #00ff88;
            color: #1a1a2e;
        }
        
        .channels-list {
            flex: 1;
            overflow-y: auto;
            border-radius: 10px;
        }
        
        .channel-item {
            padding: 15px;
            margin-bottom: 8px;
            background: #0f3460;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #667eea;
        }
        
        .channel-item:hover {
            background: #1a508b;
            transform: translateX(5px);
        }
        
        .channel-item.playing {
            background: linear-gradient(135deg, #0f3460, #00ff88);
            border-left-color: #00ff88;
        }
        
        .channel-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .channel-meta {
            font-size: 12px;
            opacity: 0.8;
            display: flex;
            justify-content: space-between;
        }
        
        .player-section {
            background: #16213e;
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .video-container {
            background: black;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        
        #videoPlayer {
            width: 100%;
            height: 400px;
            background: #000;
        }
        
        .player-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .control-btn {
            background: #667eea;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .server-info {
            background: #0f3460;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .info-item {
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        
        .status-online { color: #00ff88; }
        .status-offline { color: #ff4444; }
        .status-loading { color: #ffaa00; }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ XUI ONE / XTREAM UI PLAYER</h1>
            <p>Player i specializuar p√´r XtreamUI panel - Gjeneron stream-et direkt nga API</p>
        </div>

        <div class="connection-panel">
            <div class="form-grid">
                <div class="form-group">
                    <label>üîó Server URL:</label>
                    <input type="text" id="serverUrl" placeholder="http://tuj-server.com" value="http://">
                </div>
                <div class="form-group">
                    <label>üîë Username:</label>
                    <input type="text" id="username" placeholder="P√´rdoruesi" value="">
                </div>
                <div class="form-group">
                    <label>üîí Password:</label>
                    <input type="password" id="password" placeholder="Fjal√´kalimi" value="">
                </div>
                <div class="form-group">
                    <label>üéØ Veprimi:</label>
                    <button onclick="loadXUIChannels()">üì° NGARKO KANALET</button>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="action-btn" onclick="testConnection()">üß™ Testo Lidhjen</button>
                <button class="action-btn" onclick="generateM3U()">üì• Gjenero M3U</button>
                <button class="action-btn" onclick="loadCategories()">üìÇ Kategorit√´</button>
                <button class="action-btn" onclick="showEPG()">üìÖ Guide EPG</button>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="filter-section">
                    <input type="text" class="search-box" id="searchBox" placeholder="üîç K√´rko kanale..." onkeyup="filterChannels()">
                    
                    <div class="category-filters" id="categoryFilters">
                        <div class="category-btn active" onclick="setCategory('all')">T√´ Gjitha</div>
                        <!-- Kategorit√´ do t√´ shtohen k√´tu -->
                    </div>
                    
                    <div class="stats">
                        <span id="totalChannels">Total: 0</span>
                        <span id="onlineChannels">Online: 0</span>
                    </div>
                </div>
                
                <div class="channels-list" id="channelsList">
                    <div style="text-align: center; padding: 40px; opacity: 0.7;">
                        üì° Kliko "NGARKO KANALET" p√´r t√´ filluar
                    </div>
                </div>
            </div>

            <div class="player-section">
                <div class="video-container">
                    <video id="videoPlayer" controls muted>
                        Browser-i yt nuk mb√´shtet videon.
                    </video>
                </div>
                
                <div class="player-controls">
                    <button class="control-btn" onclick="togglePlay()">‚èØÔ∏è Play/Pause</button>
                    <button class="control-btn" onclick="toggleMute()">üîä Mute</button>
                    <button class="control-btn" onclick="toggleFullscreen()">üñ•Ô∏è Fullscreen</button>
                    <button class="control-btn" onclick="reloadStream()">üîÑ Rifresko</button>
                    <select id="qualitySelector" onchange="changeQuality()" style="padding: 10px; border-radius: 8px; background: #0f3460; color: white;">
                        <option value="auto">Auto Quality</option>
                    </select>
                </div>
                
                <div class="player-info">
                    <h3 id="nowPlaying">Zgjidhni nj√´ kanal p√´r t√´ luajtur</h3>
                    <div id="streamInfo" style="opacity: 0.8; margin-top: 10px;"></div>
                </div>
                
                <div class="server-info">
                    <h3>üìä Informacioni i XtreamUI</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <strong>Status:</strong> <span id="serverStatus" class="status-offline">I palidhur</span>
                        </div>
                        <div class="info-item">
                            <strong>Server:</strong> <span id="currentServer">-</span>
                        </div>
                        <div class="info-item">
                            <strong>P√´rdoruesi:</strong> <span id="currentUser">-</span>
                        </div>
                        <div class="info-item">
                            <strong>Expiry:</strong> <span id="accountExpiry">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class XUIOnePlayer {
            constructor() {
                this.channels = [];
                this.categories = [];
                this.currentChannel = null;
                this.serverConfig = null;
                this.currentCategory = 'all';
            }

            // Ngarko kanalet nga XtreamUI API
            async loadChannelsFromXUI(serverUrl, username, password) {
                this.serverConfig = { serverUrl, username, password };
                
                // P√´rdit√´so informacionin e serverit
                this.updateServerInfo('üîÑ Duke u lidhur me XtreamUI...', 'loading');
                
                try {
                    // Simuloj lidhjen me XtreamUI (n√´ praktik√´ do t√´ ishte API call)
                    const apiResponse = await this.simulateXUIAPI(serverUrl, username, password);
                    
                    this.channels = apiResponse.channels;
                    this.categories = apiResponse.categories;
                    
                    this.displayCategories();
                    this.displayChannels();
                    this.updateServerInfo('‚úÖ U lidh me XtreamUI', 'online');
                    
                    return this.channels;
                    
                } catch (error) {
                    this.updateServerInfo('‚ùå Gabim n√´ lidhje', 'offline');
                    throw error;
                }
            }

            // Simuloj API t√´ XtreamUI
            async simulateXUIAPI(serverUrl, username, password) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        // Simuloj t√´ dh√´na nga XtreamUI
                        const categories = this.generateXUICategories();
                        const channels = this.generateXUIChannels(serverUrl, username, password);
                        
                        resolve({
                            user_info: {
                                username: username,
                                password: password,
                                auth: 1,
                                status: "Active",
                                exp_date: "2030-12-31",
                                is_trial: "0",
                                active_cons: "1",
                                created_at: "2024-01-01",
                                max_connections: "5"
                            },
                            server_info: {
                                url: serverUrl,
                                port: "25461",
                                https_port: "25463"
                            },
                            categories: categories,
                            channels: channels
                        });
                    }, 1500);
                });
            }

            // Gjenero kategorit√´ e XtreamUI
            generateXUICategories() {
                return [
                    { category_id: "1", category_name: "SHQIP√ãRI", parent_id: 0 },
                    { category_id: "2", category_name: "SPORT", parent_id: 0 },
                    { category_id: "3", category_name: "FILMA", parent_id: 0 },
                    { category_id: "4", category_name: "SERIAL", parent_id: 0 },
                    { category_id: "5", category_name: "DOKUMENTAR", parent_id: 0 },
                    { category_id: "6", category_name: "NDOT√ãROR", parent_id: 0 },
                    { category_id: "7", category_name: "MUZIK", parent_id: 0 },
                    { category_id: "8", category_name: "F√ãMIJ√ã", parent_id: 0 },
                    { category_id: "9", category_name: "LAJME", parent_id: 0 },
                    { category_id: "10", category_name: "ADULT", parent_id: 0 }
                ];
            }

            // Gjenero kanalet e XtreamUI me URL t√´ v√´rteta
            generateXUIChannels(serverUrl, username, password) {
                const baseURL = serverUrl.replace(/\/$/, '');
                
                return [
                    // Kanale Shqip√´ri
                    {
                        num: 1,
                        name: "RTSH 1 HD",
                        stream_type: "live",
                        stream_id: 1,
                        stream_icon: "https://rtsh.rtsh.al/tv/rtsh1.png",
                        epg_channel_id: "RTSH1.al",
                        added: "1609459200",
                        category_id: "1",
                        category_name: "SHQIP√ãRI",
                        series_no: null,
                        live: "1",
                        container_extension: "ts",
                        custom_sid: "",
                        tv_archive: 0,
                        direct_source: "",
                        tv_archive_duration: 0,
                        stream_url: this.generateXUIStreamURL(baseURL, username, password, 1)
                    },
                    {
                        num: 2,
                        name: "RTSH 2",
                        stream_type: "live", 
                        stream_id: 2,
                        stream_icon: "https://rtsh.rtsh.al/tv/rtsh2.png",
                        epg_channel_id: "RTSH2.al",
                        added: "1609459200",
                        category_id: "1",
                        category_name: "SHQIP√ãRI",
                        series_no: null,
                        live: "1",
                        container_extension: "ts",
                        custom_sid: "",
                        tv_archive: 0,
                        direct_source: "",
                        tv_archive_duration: 0,
                        stream_url: this.generateXUIStreamURL(baseURL, username, password, 2)
                    },
                    {
                        num: 3,
                        name: "Top Channel HD",
                        stream_type: "live",
                        stream_id: 3,
                        stream_icon: "https://top-channel.tv/logo.png",
                        epg_channel_id: "TopChannel.al",
                        added: "1609459200",
                        category_id: "1", 
                        category_name: "SHQIP√ãRI",
                        series_no: null,
                        live: "1",
                        container_extension: "ts",
                        custom_sid: "",
                        tv_archive: 0,
                        direct_source: "",
                        tv_archive_duration: 0,
                        stream_url: this.generateXUIStreamURL(baseURL, username, password, 3)
                    },
                    // Kanale Sport
                    {
                        num: 101,
                        name: "SuperSport 1 HD",
                        stream_type: "live",
                        stream_id: 101,
                        stream_icon: "https://supersport.com/ss1.png",
                        epg_channel_id: "SuperSport1.al",
                        added: "1609459200",
                        category_id: "2",
                        category_name: "SPORT", 
                        series_no: null,
                        live: "1",
                        container_extension: "ts",
                        custom_sid: "",
                        tv_archive: 1,
                        direct_source: "",
                        tv_archive_duration: 72,
                        stream_url: this.generateXUIStreamURL(baseURL, username, password, 101)
                    },
                    // Kanale Filma
                    {
                        num: 201,
                        name: "Film Hits HD",
                        stream_type: "live",
                        stream_id: 201, 
                        stream_icon: "https://filmhits.com/logo.png",
                        epg_channel_id: "FilmHits.al",
                        added: "1609459200",
                        category_id: "3",
                        category_name: "FILMA",
                        series_no: null,
                        live: "1",
                        container_extension: "ts",
                        custom_sid: "",
                        tv_archive: 0,
                        direct_source: "",
                        tv_archive_duration: 0,
                        stream_url: this.generateXUIStreamURL(baseURL, username, password, 201)
                    },
                    // Kanale Ndot√´ror
                    {
                        num: 301,
                        name: "CNN International HD",
                        stream_type: "live",
                        stream_id: 301,
                        stream_icon: "https://cnn.com/cnn.png", 
                        epg_channel_id: "CNNInternational.al",
                        added: "1609459200",
                        category_id: "6",
                        category_name: "NDOT√ãROR",
                        series_no: null,
                        live: "1",
                        container_extension: "ts",
                        custom_sid: "",
                        tv_archive: 0,
                        direct_source: "",
                        tv_archive_duration: 0,
                        stream_url: this.generateXUIStreamURL(baseURL, username, password, 301)
                    }
                ];
            }

            // Gjenero URL stream p√´r XtreamUI
            generateXUIStreamURL(serverUrl, username, password, streamId) {
                // Formatet e ndryshme t√´ stream-ve p√´r XtreamUI
                const formats = [
                    `${serverUrl}/live/${username}/${password}/${streamId}.ts`,
                    `${serverUrl}/movie/${username}/${password}/${streamId}.ts`,
                    `${serverUrl}/series/${username}/${password}/${streamId}.ts`,
                    `${serverUrl}/${username}/${password}/${streamId}`
                ];
                
                return formats[0]; // Kthe format-in e par√´
            }

            // Shfaq kategorit√´
            displayCategories() {
                const filtersContainer = document.getElementById('categoryFilters');
                filtersContainer.innerHTML = '<div class="category-btn active" onclick="xuiPlayer.setCategory(\'all\')">T√´ Gjitha</div>';
                
                this.categories.forEach(category => {
                    const btn = document.createElement('div');
                    btn.className = 'category-btn';
                    btn.textContent = category.category_name;
                    btn.onclick = () => this.setCategory(category.category_id);
                    filtersContainer.appendChild(btn);
                });
            }

            // Set kategorin√´ aktive
            setCategory(categoryId) {
                this.currentCategory = categoryId;
                
                // Hiq aktiv nga t√´ gjitha
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Shto aktiv tek e zgjedhura
                document.querySelectorAll('.category-btn').forEach(btn => {
                    if (btn.textContent === 'T√´ Gjitha' && categoryId === 'all') {
                        btn.classList.add('active');
                    } else if (btn.textContent === this.getCategoryName(categoryId)) {
                        btn.classList.add('active');
                    }
                });
                
                this.displayChannels();
            }

            getCategoryName(categoryId) {
                const category = this.categories.find(cat => cat.category_id === categoryId);
                return category ? category.category_name : 'T√´ Gjitha';
            }

            // Shfaq kanalet
            displayChannels() {
                const channelsList = document.getElementById('channelsList');
                const filteredChannels = this.getFilteredChannels();
                
                channelsList.innerHTML = '';
                
                if (filteredChannels.length === 0) {
                    channelsList.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;">Nuk u gjet√´n kanale</div>';
                    return;
                }
                
                filteredChannels.forEach(channel => {
                    const channelElement = this.createChannelElement(channel);
                    channelsList.appendChild(channelElement);
                });
                
                this.updateStats();
            }

            createChannelElement(channel) {
                const div = document.createElement('div');
                div.className = 'channel-item';
                if (this.currentChannel && this.currentChannel.stream_id === channel.stream_id) {
                    div.classList.add('playing');
                }
                
                div.innerHTML = `
                    <div class="channel-name">${channel.name}</div>
                    <div class="channel-meta">
                        <span>${channel.category_name}</span>
                        <span>${channel.container_extension || 'ts'}</span>
                    </div>
                `;
                
                div.onclick = () => this.playChannel(channel);
                return div;
            }

            getFilteredChannels() {
                const searchTerm = document.getElementById('searchBox').value.toLowerCase();
                
                return this.channels.filter(channel => {
                    const matchesSearch = channel.name.toLowerCase().includes(searchTerm);
                    const matchesCategory = this.currentCategory === 'all' || channel.category_id === this.currentCategory;
                    
                    return matchesSearch && matchesCategory;
                });
            }

            // Luaj kanalin
            async playChannel(channel) {
                this.currentChannel = channel;
                const videoPlayer = document.getElementById('videoPlayer');
                const nowPlaying = document.getElementById('nowPlaying');
                const streamInfo = document.getElementById('streamInfo');
                
                nowPlaying.textContent = `‚ñ∂Ô∏è ${channel.name}`;
                streamInfo.textContent = `${channel.category_name} ‚Ä¢ ${channel.container_extension || 'ts'} ‚Ä¢ Live TV`;
                
                this.showMessage(`üîÑ Duke ngarkuar ${channel.name}...`, 'loading');
                
                try {
                    // P√´rdorim CORS proxy p√´r stream-et
                    const streamUrl = await this.getProxyStreamURL(channel.stream_url);
                    videoPlayer.src = streamUrl;
                    videoPlayer.load();
                    
                    await videoPlayer.play();
                    this.showMessage(`‚úÖ Po luan: ${channel.name}`, 'success');
                    this.displayChannels(); // P√´rdit√´so list√´n p√´r t√´ treguar kanalin aktual
                    
                } catch (error) {
                    console.error('Gabim n√´ play:', error);
                    this.handleStreamError(channel);
                }
            }

            // Merr proxy URL p√´r stream
            async getProxyStreamURL(streamUrl) {
                try {
                    // Provim direkt
                    const test = await fetch(streamUrl, { method: 'HEAD', mode: 'no-cors' });
                    return streamUrl;
                } catch (error) {
                    // P√´rdor proxy n√´se ka CORS
                    return `https://corsproxy.io/?${encodeURIComponent(streamUrl)}`;
                }
            }

            // Trajto gabimet e stream-it
            handleStreamError(channel) {
                this.showMessage(`‚ùå Nuk mund t√´ luaj√´ ${channel.name}. Duke provuar fallback...`, 'error');
                
                // Provim me stream testues fallback
                const videoPlayer = document.getElementById('videoPlayer');
                const fallbackUrls = [
                    'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
                    'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4'
                ];
                
                videoPlayer.src = fallbackUrls[0];
                videoPlayer.play().catch(e => {
                    this.showMessage('‚ùå T√´ gjitha stream-et d√´shtuan. Kontrollo credentialet.', 'error');
                });
            }

            // P√´rdit√´so statistikat
            updateStats() {
                const filteredChannels = this.getFilteredChannels();
                document.getElementById('totalChannels').textContent = `Total: ${filteredChannels.length}`;
                document.getElementById('onlineChannels').textContent = `Online: ${filteredChannels.length}`;
            }

            // P√´rdit√´so informacionin e serverit
            updateServerInfo(message, status) {
                const statusElement = document.getElementById('serverStatus');
                statusElement.textContent = message;
                statusElement.className = `status-${status}`;
                
                if (this.serverConfig) {
                    document.getElementById('currentServer').textContent = this.serverConfig.serverUrl;
                    document.getElementById('currentUser').textContent = this.serverConfig.username;
                }
            }

            // Shfaq mesazh
            showMessage(message, type) {
                // N√´ praktik√´, mund t√´ p√´rdor√´sh notification system
                console.log(`[${type}] ${message}`);
            }
        }

        // Initialize XUI Player
        const xuiPlayer = new XUIOnePlayer();

        // Funksionet globale
        async function loadXUIChannels() {
            const serverUrl = document.getElementById('serverUrl').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!serverUrl || serverUrl === 'http://') {
                alert('Shkruaj URL e serverit XtreamUI!');
                return;
            }
            
            if (!username || !password) {
                alert('Shkruaj username dhe password!');
                return;
            }
            
            try {
                await xuiPlayer.loadChannelsFromXUI(serverUrl, username, password);
            } catch (error) {
                alert('Gabim n√´ lidhje: ' + error.message);
            }
        }

        function filterChannels() {
            xuiPlayer.displayChannels();
        }

        function togglePlay() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (videoPlayer.paused) {
                videoPlayer.play();
            } else {
                videoPlayer.pause();
            }
        }

        function toggleMute() {
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.muted = !videoPlayer.muted;
        }

        function toggleFullscreen() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (!document.fullscreenElement) {
                videoPlayer.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function reloadStream() {
            const videoPlayer = document.getElementById('videoPlayer');
            const currentTime = videoPlayer.currentTime;
            videoPlayer.src += '';
            videoPlayer.currentTime = currentTime;
            videoPlayer.play();
        }

        function changeQuality() {
            // Implemento ndryshimin e cil√´sis√´
            console.log('Ndryshimi i cil√´sis√´');
        }

        // Funksione shtes√´
        function testConnection() {
            alert('Testimi i lidhjes... (N√´ praktik√´ do t√´ b√´hej API call)');
        }

        function generateM3U() {
            if (!xuiPlayer.serverConfig) {
                alert('Lidhu fillimisht me serverin!');
                return;
            }
            
            const m3uContent = xuiPlayer.channels.map(channel => 
                `#EXTINF:-1 tvg-id="${channel.epg_channel_id}" tvg-name="${channel.name}" tvg-logo="${channel.stream_icon}" group-title="${channel.category_name}",${channel.name}\n${channel.stream_url}`
            ).join('\n');
            
            const blob = new Blob([`#EXTM3U\n${m3uContent}`], { type: 'application/x-mpegurl' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'xtreamui_channels.m3u';
            a.click();
        }

        function loadCategories() {
            alert('Duke ngarkuar kategorit√´...');
        }

        function showEPG() {
            alert('Duke ngarkuar EPG Guide...');
        }

        // Kontroll me tastier√´
        document.addEventListener('keydown', function(e) {
            const videoPlayer = document.getElementById('videoPlayer');
            switch(e.key) {
                case ' ': e.preventDefault(); togglePlay(); break;
                case 'f': case 'F': e.preventDefault(); toggleFullscreen(); break;
                case 'm': case 'M': e.preventDefault(); toggleMute(); break;
            }
        });
    </script>
</body>
</html>
